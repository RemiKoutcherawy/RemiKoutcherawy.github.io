<html lang="fr">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link>
  <meta charset="UTF-8"/>
  <title>cocotte.html</title>
  <style>
    body { display:block; margin:5px;}
    #height100 { position:relative; width:100%; height:100%;}
    #canvas3d { position:absolute; width:100%; height:100%; left:0; top:0; border:1px solid darkblue;}
    .menu {position:absolute; top:10px; right:10px; background-color:#ABD1FF; opacity:1; z-index:20}
    .svg-icon {display: block; width: 36px; height: 36px;}
  </style>
  <!-- copy of app.js -->
  <script type="application/javascript">
    function Point(t,i,e,n,o){return 3===arguments.length?(this.x=t,this.y=i,this.z=e,this.xf=t,this.yf=i,this):2===arguments.length?(this.xf=t,this.yf=i,this.x=t,this.y=i,this.z=0,this):(this.xf=0|t,this.yf=0|i,this.x=0|e,this.y=0|n,this.z=0|o,this)}function Plane(t,i){this.r=t,this.n=i}function Segment(t,i,e){this.p1=t,this.p2=i,this.type=Segment.PLAIN|e,this.lg2d=this.length2d(),this.lg3d=this.length3d(),this.angle=0,this.highlight=!1}function Face(){this.points=[],this.normal=[0,0,1],this.select=0,this.highlight=!1,this.offset=0}function Model(){this.points=[],this.segments=[],this.faces=[]}function Command(t){this.model=t,this.toko=[],this.done=[],this.iTok=0,this.state=State.idle,this.tni=1,this.tpi=0,this.interpolator=Interpolator.LinearInterpolator,this.za=[0,0,0,0],this.interpolator=Interpolator.LinearInterpolator,this.kOffset=1}function View2d(t,i){this.model=t,this.canvas2d=i,this.canvas2d.view2d=this,null!==this.canvas2d&&(this.ctx=this.canvas2d.getContext("2d"),this.scale=1,this.xOffset=0,this.yOffset=0,this.fit(),this.canvas2d.addEventListener("mousedown",this.mouseDown))}function View3d(t,i){this.model=t,this.canvas3d=i,this.gl=this.canvas3d.getContext("webgl")||i.getContext("experimental-webgl"),this.initWebGL()}function CommandArea(t,i){i.addEventListener("keypress",CommandArea.keypress),CommandArea.textArea=i,CommandArea.cde=t}function Orisim3d(t,i,e,n){this.model=t,this.view2d=i,this.view3d=e,this.command=n}function completed(){window.removeEventListener("load",completed);var t=new Model;t.init([-200,-200,200,-200,200,200,-200,200]);var i=new Command(t),e=window.document.getElementById("canvas2d"),n=e?new View2d(t,e):null,o=window.document.getElementById("canvas3d"),s=o?new View3d(t,o):null,r=window.document.getElementById("commandarea");r&&new CommandArea(i,r),orisim3d=new Orisim3d(t,n,s,i),requestAnimationFrame(loop)}function loop(){orisim3d.model.change&&(null!==orisim3d.view2d&&orisim3d.view2d.draw(),null!==orisim3d.view3d&&orisim3d.view3d.initBuffers(),orisim3d.model.change=!!orisim3d.command.anim()),orisim3d.view3d.draw(),requestAnimationFrame(loop)}function Menu(t){t.addEventListener("click",this.click)}Point.prototype={constructor:Point,set5d:function(t,i,e,n,o){this.xf=0|t,this.yf=0|i,this.x=0|e,this.y=0|n,this.z=0|o},set3d:function(t,i,e){this.x=0|t,this.y=0|i,this.z=0|e},set2d:function(t,i){this.xf=0|t,this.yf=0|i},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this},norm:function(){var t=this.length();return this.scale(1/t)},toString:function(){return"["+Math.round(this.x)+","+Math.round(this.y)+","+Math.round(this.z)+"  "+Math.round(this.xf)+","+Math.round(this.yf)+"]"},toXYZString:function(){return"["+Math.round(this.x)+","+Math.round(this.y)+","+Math.round(this.z)+"]"},toXYString:function(){return"["+Math.round(this.xf)+","+Math.round(this.yf)+"]"}},Point.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},Point.add=function(t,i){return new Point(t.x+i.x,t.y+i.y,t.z+i.z)},Point.sub=function(t,i){return new Point(t.x-i.x,t.y-i.y,t.z-i.z)},Point.compare3d=function(t,i,e,n){if(2===arguments.length){var o=(t.x-i.x)*(t.x-i.x),s=(t.y-i.y)*(t.y-i.y),r=(t.z-i.z)*(t.z-i.z),h=o+s+r;h=h>1?h:0}else h=(h=(o=(t.x-i)*(t.x-i))+(s=(t.y-e)*(t.y-e))+(r=(t.z-n)*(t.z-n)))>1?h:0;return h},Point.compare2d=function(t,i){var e=(t.xf-i.xf)*(t.xf-i.xf),n=(t.yf-i.yf)*(t.yf-i.yf);return Math.sqrt(e+n)};var Point;Plane.THICKNESS=1,Plane.across=function(t,i){var e=new Point((t.x+i.x)/2,(t.y+i.y)/2,(t.z+i.z)/2),n=new Point(i.x-t.x,i.y-t.y,i.z-t.z);return new Plane(e,n)},Plane.by=function(t,i){var e=new Point(t.x,t.y,t.z),n=new Point(i.y-t.y,-(i.x-t.x),0);return new Plane(e,n)},Plane.ortho=function(t,i){var e=new Point(i.x,i.y,i.z),n=new Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z);return new Plane(e,n)},Plane.prototype={isOnPlane:function(t){var i=Point.sub(t,this.r),e=Point.dot(i,this.n);return Math.abs(e)<.1},intersectPoint:function(t,i){var e=new Point(i.x-t.x,i.y-t.y,i.z-t.z),n=Point.dot(e,this.n);if(0===n)return null;var o=(Point.dot(this.r,this.n)-Point.dot(t,this.n))/n;return o>=0&&o<=1?Point.add(t,e.scale(o)):null},intersectSeg:function(t){var i=new Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z),e=Point.dot(i,this.n);if(0===e)return null;var n=(Point.dot(this.r,this.n)-Point.dot(t.p1,this.n))/e;return n>=0&&n<=1?Point.add(t.p1,i.scale(n)):null},classifyPointToPlane:function(t){var i=Point.dot(this.r,this.n)-Point.dot(this.n,t);return i>Plane.THICKNESS?1:i<-Plane.THICKNESS?-1:0},toString:function(){return"Pl[r:"+this.r+" n:"+this.n+"]"}};var Point;Segment.PLAIN=0,Segment.EDGE=1,Segment.MOUNTAIN=2,Segment.VALLEY=3,Segment.TEMPORARY=-1,Segment.EPSILON=.01,Segment.prototype={constructor:Segment,reverse:function(){const t=this.p1;this.p1=this.p2,this.p2=t},length3d:function(){return this.lg3d=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y)+(this.p1.z-this.p2.z)*(this.p1.z-this.p2.z)),this.lg3d},length2d:function(){return this.lg2d=Math.sqrt((this.p1.xf-this.p2.xf)*(this.p1.xf-this.p2.xf)+(this.p1.yf-this.p2.yf)*(this.p1.yf-this.p2.yf)),this.lg2d},toString:function(){return"S(P1:"+this.p1.toXYZString()+" "+this.p1.toXYString()+", P2:"+this.p2.toXYZString()+" "+this.p2.toXYString()+")"}},Segment.compare=function(t,i){var e=Point.compare3d(t.p1,i.p1)+Point.compare3d(i.p2,i.p2);return e>1?e:0},Segment.distanceToSegment=function(t,i){var e=t.p1.x,n=t.p1.y,o=t.p2.x,s=t.p2.y,r=i.x,h=i.y,a=(e-o)*(e-o)+(n-s)*(n-s),l=((n-h)*(n-s)+(e-r)*(e-o))/a,c=((n-h)*(o-e)-(e-r)*(s-n))/a;return l<=0?Math.sqrt((r-e)*(r-e)+(h-n)*(h-n)):l>=1?Math.sqrt((r-o)*(r-o)+(h-s)*(h-s)):Math.abs(c)*Math.sqrt(a)},Segment.closestSeg=function(t,i){var e,n,o=new Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z),s=new Point(i.p2.x-i.p1.x,i.p2.y-i.p1.y,i.p2.z-i.p1.z),r=new Point(t.p1.x-i.p1.x,t.p1.y-i.p1.y,t.p1.z-i.p1.z),h=Point.dot(o,o),a=Point.dot(s,s),l=Point.dot(s,r);if(h<=Segment.EPSILON&&a<=Segment.EPSILON)return e=n=0,new Segment(t.p1,i.p1,Segment.TEMPORARY);if(h<=Segment.EPSILON)e=0,n=(n=l/a)<0?0:n>1?1:n;else{var c=Point.dot(o,r);if(a<=Segment.EPSILON)n=0,e=(e=-c/h)<0?0:e>1?1:e;else{var u=Point.dot(o,s),d=h*a-u*u;(n=(u*(e=0!==d?(e=(u*l-c*a)/d)<0?0:e>1?1:e:0)+l)/a)<0?(n=0,e=(e=-c/h)<0?0:e>1?1:e):n>1&&(n=1,e=(e=(u-c)/h)<0?0:e>1?1:e)}}var p=Point.add(t.p1,o.scale(e)),f=Point.add(i.p1,s.scale(n));return new Segment(p,f)},Segment.closestLine=function(t,i){var e,n,o=new Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z),s=new Point(i.p2.x-i.p1.x,i.p2.y-i.p1.y,i.p2.z-i.p1.z),r=new Point(t.p1.x-i.p1.x,t.p1.y-i.p1.y,t.p1.z-i.p1.z),h=Point.dot(o,o),a=Point.dot(s,s),l=Point.dot(s,r);if(h<=Segment.EPSILON&&a<=Segment.EPSILON)return e=n=0,new Segment(t.p1,i.p1,Segment.TEMPORARY,-1);if(h<=Segment.EPSILON)e=0,n=l/a;else{var c=Point.dot(o,r);if(a<=Segment.EPSILON)n=0,e=-c/h;else{var u=Point.dot(o,s),d=h*a-u*u;n=(u*(e=0!==d?(u*l-c*a)/d:0)+l)/a}}var p=Point.add(t.p1,o.scale(e)),f=Point.add(i.p1,s.scale(n));return new Segment(p,f)},Face.prototype={constructor:Face,computeFaceNormal:function(){if(this.points.length<3)return console.log("Warn Face < 3pts:"+this),null;for(let t=0;t<this.points.length-2;t++){let i=this.points[t],e=this.points[t+1],n=this.points[t+2],o=[e.x-i.x,e.y-i.y,e.z-i.z],s=[n.x-i.x,n.y-i.y,n.z-i.z];if(this.normal[0]=o[1]*s[2]-o[2]*s[1],this.normal[1]=o[2]*s[0]-o[0]*s[2],this.normal[2]=o[0]*s[1]-o[1]*s[0],Math.abs(this.normal[0])+Math.abs(this.normal[1])+Math.abs(this.normal[2])>.1)break}return this.normalize(this.normal),this.normal},normalize:function(t){let i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=i,t[1]/=i,t[2]/=i},toString:function(){let t="F(";return this.points.forEach(function(i,e,n){t=t+"P"+e+i.toString()+(e===n.length-1?"":" ")}),t+=")"}};var Point,Segment,Face,Plane;Model.prototype={constructor:Model,init:function(t){this.points=[],this.segments=[],this.faces=[],this.change=!0;for(var i=new Face,e=null,n=0;n<t.length;n+=2){var o=this.addPointXYZ(t[n],t[n+1],t[n],t[n+1],0);i.points.push(o),null!==e&&this.addSegment(e,o,Segment.EDGE),e=o}return this.addSegment(e,i.points[0],Segment.EDGE),this.addFace(i),this},addPointXYZ:function(t,i,e,n,o){var s=null;return 2===arguments.length?s=new Point(t,i):3===arguments.length?s=new Point(e,n,o):5===arguments.length?s=new Point(t,i,e,n,o):console.log("Warn wrong number of Args for addPointXYZ"),this.points.push(s),s},addPoint:function(t){for(var i=0;i<this.points.length;i++)if(Point.compare3d(this.points[i],t)<1)return this.points[i];return this.points.push(t),t},addSegment:function(t,i,e){if(0===Point.compare3d(t,i))return console.log("Warn Add degenerate segment:"+t),null;var n=new Segment(t,i,e);return this.segments.push(n),n},addFace:function(t){return this.faces.push(t),t},align2dFrom3d:function(t,i){var e=Math.sqrt((i.p1.x-t.x)*(i.p1.x-t.x)+(i.p1.y-t.y)*(i.p1.y-t.y)+(i.p1.z-t.z)*(i.p1.z-t.z))/i.length3d();t.xf=i.p1.xf+e*(i.p2.xf-i.p1.xf),t.yf=i.p1.yf+e*(i.p2.yf-i.p1.yf)},faceRight:function(t,i){void 0===i&&(i=t.p2,t=t.p1);var e=0,n=0,o=null;return this.faces.forEach(function(s){(e=s.points.indexOf(t))>=0&&(n=s.points.indexOf(i))>=0&&(e===n+1||n===s.points.length-1&&0===e)&&(o=s)}),o},faceLeft:function(t,i){void 0===i&&(i=t.p2,t=t.p1);var e,n,o=null;return this.faces.forEach(function(s){(e=s.points.indexOf(t))>=0&&(n=s.points.indexOf(i))>=0&&(n===e+1||e===s.points.length-1&&0===n)&&(o=s)}),o},searchFace:function(t,i){var e=t.p1,n=t.p2,o=null;return this.faces.forEach(function(t){null===i&&t.points.indexOf(e)>-1&&t.points.indexOf(n)>-1?o=t:t!==i&&t.points.indexOf(e)>-1&&t.points.indexOf(n)>-1&&(o=t)}),o},computeAngle:function(t){var i=t.p1,e=t.p2,n=this.faceLeft(i,e),o=this.faceRight(i,e);if(t.type===Segment.EDGE)return console.log("Warn Angle on Edge:"+t),0;if(null===o||null===n)return console.log("Warn No right and left face for:"+t+" left:"+n+" right:"+o),0;var s=n.computeFaceNormal(),r=o.computeFaceNormal(),h=s[1]*r[2]-s[2]*r[1],a=s[2]*r[0]-s[0]*r[2],l=s[0]*r[1]-s[1]*r[0],c=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,d=t.p2.z-t.p1.z,p=(h*c+a*u+l*d)/Math.sqrt(c*c+u*u+d*d),f=s[0]*r[0]+s[1]*r[1]+s[2]*r[2];return f>1&&(f=1),f<-1&&(f=-1),t.angle=Math.acos(f)/Math.PI*180,Number.isNaN(t.angle)&&(t.angle=0),p<0&&(t.angle=-t.angle),t.angle=-t.angle,t.angle},searchSegmentTwoPoints:function(t,i){var e=[];return this.segments.forEach(function(n){(0===Point.compare3d(n.p1,t)&&0===Point.compare3d(n.p2,i)||0===Point.compare3d(n.p2,t)&&0===Point.compare3d(n.p1,i))&&e.push(n)}),e.length>1&&console.log("Error More than one segment on 2 points:"+e.length+" "+e[0].p1+e[0].p2+" "+e[1].p1+e[1].p2),0===e.length?null:e[0]},searchSegmentsOnePoint:function(t){var i=[];return this.segments.forEach(function(e){e.p1!==t&&e.p2!==t||i.push(e)}),i},splitSegmentByPoint:function(t,i){if(0===Point.compare3d(t.p1,i)||0===Point.compare3d(t.p2,i))return t;var e=this.addSegment(i,t.p2,t.type);return t.p2=i,t.length2d(),t.length3d(),e},splitSegmentOnPoint:function(t,i){var e=null,n=null;this.align2dFrom3d(i,t);var o=this.searchFace(t,null);if(null!==o&&-1===o.points.indexOf(i))for(e=o.points,n=0;n<e.length;n++){if(e[n]===t.p1&&e[n===e.length-1?0:n+1]===t.p2){e.splice(n+1,0,i);break}if(e[n]===t.p2&&e[n===e.length-1?0:n+1]===t.p1){e.splice(n+1,0,i);break}}var s=this.searchFace(t,o);if(null!==s&&-1===s.points.indexOf(i))for(e=s.points,n=0;n<e.length;n++){if(e[n]===t.p1&&e[n===e.length-1?0:n+1]===t.p2){e.splice(n+1,0,i);break}if(e[n]===t.p2&&e[n===e.length-1?0:n+1]===t.p1){e.splice(n+1,0,i);break}}return this.addPoint(i),this.splitSegmentByPoint(t,i),t},splitSegmentByRatio:function(t,i){var e=new Point;e.set3d(t.p1.x+i*(t.p2.x-t.p1.x),t.p1.y+i*(t.p2.y-t.p1.y),t.p1.z+i*(t.p2.z-t.p1.z)),this.splitSegmentOnPoint(t,e)},splitFaceByPlane:function(t,i){for(var e=[],n=[],o=!1,s=!1,r=null,h=t.points[t.points.length-1],a=i.classifyPointToPlane(h),l=0;l<t.points.length;l++){var c=t.points[l],u=i.classifyPointToPlane(c);if(1===u){if(-1===a){var d=i.intersectPoint(c,h),p=this.addPoint(d);e.push(p),n.push(p);var f=this.searchSegmentTwoPoints(h,c),m=this.segments.indexOf(f);-1!==m&&(this.align2dFrom3d(p,f),this.addSegment(p,c,Segment.PLAIN),f.p1===h?f.p2=p:f.p1=p),null!==r?(this.addSegment(r,p,Segment.PLAIN),r=null):r=p}else 0===a&&(r=h);e.push(c),o=!0}else-1===u?(1===a?(d=i.intersectPoint(c,h),p=this.addPoint(d),e.push(p),n.push(p),f=this.searchSegmentTwoPoints(h,c),-1!==(m=this.segments.indexOf(f))&&(this.align2dFrom3d(p,f),this.addSegment(p,c,Segment.PLAIN),f.p1===h?f.p2=p:f.p1=p),null!==r&&p!==r?(this.addSegment(r,p),r=null):r=p):0===a&&(n[n.length-1]!==h&&n.push(h),null!==r&&r!==h?(this.addSegment(r,h,Segment.PLAIN),r=null):r=h),n.push(c),s=!0):0===u&&(-1===a&&(n.push(c),null!==r&&r!==c?(null===(f=this.searchSegmentTwoPoints(r,c))&&this.addSegment(r,c,Segment.PLAIN),r=null):r=c),e.push(c));h=c,a=u}if(o&&(t.points=e,t=null),s)if(null!==t)t.points=n;else{var g=new Face;g.points=n,this.faces.push(g)}},splitFacesByPlane:function(t,i){for(var e=(i=void 0!==i?i:this.faces).length-1;e>-1;e--){var n=i[e];this.splitFaceByPlane(n,t)}},splitCross:function(t,i,e){var n=Plane.across(t,i);this.splitFacesByPlane(n,e)},splitBy:function(t,i,e){var n=Plane.by(t,i);this.splitFacesByPlane(n,e)},splitOrtho:function(t,i,e){var n=Plane.ortho(t,i);this.splitFacesByPlane(n,e)},splitLineToLineByPoints:function(t,i,e,n){var o=Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y)+(i.z-t.z)*(i.z-t.z))/Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)+(i.z-e.z)*(i.z-e.z)),s=i.x+o*(e.x-i.x),r=i.y+o*(e.y-i.y),h=i.z+o*(e.z-i.z),a=new Point(s,r,h),l=Plane.by(t,a);this.splitFacesByPlane(l,n)},splitLineToLine:function(t,i,e){var n=Segment.closestLine(t,i);if(n.length3d()<1){var o=n.p1,s=Point.sub(t.p1,o).length()>Point.sub(t.p2,o).length()?t.p1:t.p2,r=Point.sub(i.p1,o).length()>Point.sub(i.p2,o).length()?i.p1:i.p2;this.splitLineToLineByPoints(s,o,r,e)}else{var h=Plane.across(n.p1,n.p2);this.splitFacesByPlane(h,e)}},rotate:function(t,i,e){var n=i*Math.PI/180,o=t.p1.x,s=t.p1.y,r=t.p1.z,h=t.p2.x-o,a=t.p2.y-s,l=t.p2.z-r,c=1/Math.sqrt(h*h+a*a+l*l);h*=c,a*=c,l*=c;var u=Math.sin(n),d=Math.cos(n),p=1-d,f=p*h*h+d,m=p*h*a-l*u,g=p*h*l+a*u,k=p*a*h+l*u,v=p*a*a+d,T=p*a*l-h*u,x=p*l*h-a*u,y=p*l*a+h*u,P=p*l*l+d;e.forEach(function(t){var i=t.x-o,e=t.y-s,n=t.z-r;t.x=o+f*i+m*e+g*n,t.y=s+k*i+v*e+T*n,t.z=r+x*i+y*e+P*n})},adjust:function(t,i){for(var e=i||this.searchSegmentsOnePoint(t),n=100,o=0;n>.001&&o<20;o++){n=0;for(var s=new Point(0,0,0),r=0;r<e.length;r++){var h=e[r],a=h.length3d(),l=h.length2d(),c=l-a;Math.abs(c)>n&&(n=Math.abs(c));var u=l/a;h.p2===t?(s.x+=h.p1.x+(h.p2.x-h.p1.x)*u,s.y+=h.p1.y+(h.p2.y-h.p1.y)*u,s.z+=h.p1.z+(h.p2.z-h.p1.z)*u):h.p1===t&&(s.x+=h.p2.x+(h.p1.x-h.p2.x)*u,s.y+=h.p2.y+(h.p1.y-h.p2.y)*u,s.z+=h.p2.z+(h.p1.z-h.p2.z)*u)}0!==e.length&&(t.x=s.x/e.length,t.y=s.y/e.length,t.z=s.z/e.length)}return n},adjustList:function(t){for(var i=100,e=0;i>.001&&e<100;e++){i=0;for(var n=0;n<t.length;n++){var o=t[n],s=this.searchSegmentsOnePoint(o),r=this.adjust(o,s);Math.abs(r)>i&&(i=Math.abs(r))}}return i},evaluate:function(){for(var t=0;t<this.segments.length;t++){var i=this.segments[t],e=Math.abs(i.length2d()-i.length3d());i.highlight=e>=.1}},move:function(t,i,e,n){(n=null===n?this.points:0===n.length?this.points:n).forEach(function(n){n.x+=t,n.y+=i,n.z+=e})},moveOn:function(t,i,e,n){n.forEach(function(n){n.x=t.x*i+n.x*e,n.y=t.y*i+n.y*e,n.z=t.z*i+n.z*e})},flat:function(t){(0===t.length?this.points:t).forEach(function(t){t.z=0})},turn:function(t,i){i*=Math.PI/180;var e=0,n=0,o=0;1===t?e=1:2===t?n=1:3===t&&(o=1);var s=1/Math.sqrt(e*e+n*n+o*o);e*=s,n*=s,o*=s;var r=Math.sin(i),h=Math.cos(i),a=1-h,l=a*e*e+h,c=a*e*n-o*r,u=a*e*o+n*r,d=a*n*e+o*r,p=a*n*n+h,f=a*n*o-e*r,m=a*o*e-n*r,g=a*o*n+e*r,k=a*o*o+h;this.points.forEach(function(t){var i=t.x-0,e=t.y-0,n=t.z-0;t.x=0+l*i+c*e+u*n,t.y=0+d*i+p*e+f*n,t.z=0+m*i+g*e+k*n})},selectPts:function(t){t.forEach(function(t){t.select^=!0})},selectSegs:function(t){t.forEach(function(t){t.select^=!0})},offset:function(t,i){i.forEach(function(i){i.offset+=t})},get2DBounds:function(){var t=-100,i=100,e=-100,n=100;this.points.forEach(function(o){var s=o.xf,r=o.yf;s>t&&(t=s),s<i&&(i=s),r>e&&(e=r),r<n&&(n=r)});var o={};return o.xmin=i,o.ymin=n,o.xmax=t,o.ymax=e,o},zoomFit:function(){var t=this.get3DBounds(),i=400/Math.max(t[2]-t[0],t[3]-t[1]),e=-(t[0]+t[2])/2,n=-(t[1]+t[3])/2;this.move(e,n,0,null),this.scaleModel(i)},scaleModel:function(t){this.points.forEach(function(i){i.x*=t,i.y*=t,i.z*=t})},get3DBounds:function(){var t=-200,i=200,e=-200,n=200;return this.points.forEach(function(o){var s=o.x,r=o.y;s>t&&(t=s),s<i&&(i=s),r>e&&(e=r),r<n&&(n=r)}),[i,n,t,e]}};var Interpolator={LinearInterpolator:function(t){return t},AccelerateDecelerateInterpolator:function(t){return Math.cos((t+1)*Math.PI)/2+.5},SpringOvershootInterpolator:function(t){return t<.1825?((-237.11*t+61.775)*t+3.664)*t+0:t<.425?((74.243*t-72.681)*t+21.007)*t-.579:t<.6875?((-16.378*t+28.574)*t-15.913)*t+3.779:t<1?((5.12*t-12.8)*t+10.468)*t-1.788:((-176.823*t+562.753)*t-594.598)*t+209.669},SpringBounceInterpolator:function(t){var i=0;return(i=t<.185?((-94.565*t+28.123)*t+2.439)*t+0:t<.365?((-3.215*t-4.89)*t+5.362)*t+.011:t<.75?((5.892*t-10.432)*t+5.498)*t+.257:t<1?((1.52*t-2.48)*t+.835)*t+1.125:((-299.289*t+945.19)*t-991.734)*t+346.834)>1?2-i:i},GravityBounceInterpolator:function(t){var i=0;return(i=t<.29?((-14.094*t+9.81)*t-.142)*t+0:t<.62?((-16.696*t+21.298)*t-6.39)*t+.909:t<.885?((31.973*t-74.528)*t+56.497)*t-12.844:t<1?((-37.807*t+114.745)*t-114.938)*t+39:((-7278.029*t+22213.034)*t-22589.244)*t+7655.239)>1?2-i:i},BounceInterpolator:function(t){function i(t){return t*t*8}return(t*=1.1226)<.3535?i(t):t<.7408?i(t-.54719)+.7:t<.9644?i(t-.8526)+.9:i(t-1.0435)+.95},OvershootInterpolator:function(t){return(t-=1)*t*(3*t+2)+1},AnticipateInterpolator:function(t){return t*t*(1*t-0)},AnticipateOvershootInterpolator:function(t){return t<.5?.5*function(t,i){return t*t*((i+1)*t-i)}(2*t,1.5):.5*(function(t,i){return t*t*((i+1)*t+i)}(2*t-2,1.5)+2)}},Model,Interpolator;const State={idle:0,run:1,anim:2,pause:3,undo:4};Command.prototype={constructor:Command,tokenize:function(t){var i=t.replace(/[\);]/g," rparent");return i=i.replace(/,/g," "),i=i.replace(/\/\/.*$/gm,""),this.toko=i.split(/\s+/),this.iTok=0,this.toko},readfile:function(t){var i=null;{const e=new XMLHttpRequest;e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&200===e.status?e.getResponseHeader("Content-Type").match(/^text/)&&(i=e.responseText):e.readyState!==XMLHttpRequest.OPENED&&console.log("Error ? state:"+e.readyState+" status:"+e.status)},e.open("GET",t,!1),e.send(null)}return null===i&&console.log("Error reading:"+t),i},execute:function(){var t=[],i=null,e=null,n=null,o=null,s=null;if("d"===this.toko[this.iTok]||"define"===this.toko[this.iTok]){for(this.iTok++;Number.isInteger(Number(this.toko[this.iTok]));)t.push(this.toko[this.iTok++]);this.model.init(t)}else if("b"===this.toko[this.iTok]||"by"===this.toko[this.iTok])this.iTok++,i=this.model.points[this.toko[this.iTok++]],e=this.model.points[this.toko[this.iTok++]],this.model.splitBy(i,e);else if("c"===this.toko[this.iTok]||"cross"===this.toko[this.iTok])this.iTok++,i=this.model.points[this.toko[this.iTok++]],e=this.model.points[this.toko[this.iTok++]],this.model.splitCross(i,e);else if("p"===this.toko[this.iTok]||"perpendicular"===this.toko[this.iTok])this.iTok++,o=this.model.segments[this.toko[this.iTok++]],s=this.model.points[this.toko[this.iTok++]],this.model.splitOrtho(o,s);else if("lol"===this.toko[this.iTok]||"lineonline"===this.toko[this.iTok]){this.iTok++;var r=this.model.segments[this.toko[this.iTok++]],h=this.model.segments[this.toko[this.iTok++]];this.model.splitLineToLine(r,h)}else if("s"===this.toko[this.iTok]||"split"===this.toko[this.iTok]){this.iTok++,o=this.model.segments[this.toko[this.iTok++]];var a=this.toko[this.iTok++],l=this.toko[this.iTok++];this.model.splitSegmentByRatio(o,a/l)}else if("r"===this.toko[this.iTok]||"rotate"===this.toko[this.iTok])this.iTok++,o=this.model.segments[this.toko[this.iTok++]],n=this.toko[this.iTok++]*(this.tni-this.tpi),t=this.listPoints(),this.model.rotate(o,n,t);else if("f"===this.toko[this.iTok]||"fold"===this.toko[this.iTok])this.iTok++,o=this.model.segments[this.toko[this.iTok++]],0===this.tpi&&(this.angleBefore=this.model.computeAngle(o)),n=(this.toko[this.iTok++]-this.angleBefore)*(this.tni-this.tpi),t=this.listPoints(),0===this.tpi&&-1!==this.model.faceRight(o.p1,o.p2).points.indexOf(t[0])&&o.reverse(),this.model.rotate(o,n,t);else if("a"===this.toko[this.iTok]||"adjust"===this.toko[this.iTok]){this.iTok++;var c=0===(t=this.listPoints()).length?this.model.points:t;this.model.adjustList(c)}else if("o"===this.toko[this.iTok]||"offset"===this.toko[this.iTok]){this.iTok++;var u=this.toko[this.iTok++]*this.kOffset;t=this.listFaces(),this.model.offset(u,t)}else if("m"===this.toko[this.iTok]||"move"===this.toko[this.iTok])this.iTok++,this.model.move(this.toko[this.iTok++]*(this.tni-this.tpi),this.toko[this.iTok++]*(this.tni-this.tpi),this.toko[this.iTok++]*(this.tni-this.tpi),this.model.points);else if("mo"===this.toko[this.iTok]){this.iTok++;var d=this.model.points.get(this.toko[this.iTok++]),p=(1-this.tni)/(1-this.tpi),f=this.tni-this.tpi*p;this.model.moveOn(d,f,p,this.model.points)}else if("tx"===this.toko[this.iTok])this.iTok++,this.model.turn(1,Number(this.toko[this.iTok++])*(this.tni-this.tpi));else if("ty"===this.toko[this.iTok])this.iTok++,this.model.turn(2,Number(this.toko[this.iTok++])*(this.tni-this.tpi));else if("tz"===this.toko[this.iTok])this.iTok++,this.model.turn(3,Number(this.toko[this.iTok++])*(this.tni-this.tpi));else if("z"===this.toko[this.iTok]){this.iTok++;var m=this.toko[this.iTok++],g=this.toko[this.iTok++],k=this.toko[this.iTok++],v=(1+this.tni*(m-1))/(1+this.tpi*(m-1)),T=m*(this.tni/v-this.tpi);this.model.move(g*T,k*T,0,null),this.model.scaleModel(v)}else if("zf"===this.toko[this.iTok]){if(this.iTok++,0===this.tpi){e=this.model.get3DBounds();this.za[0]=400/Math.max(e[2]-e[0],e[3]-e[1]),this.za[1]=-(e[0]+e[2])/2,this.za[2]=-(e[1]+e[3])/2}m=(1+this.tni*(this.za[0]-1))/(1+this.tpi*(this.za[0]-1)),T=this.za[0]*(this.tni/m-this.tpi),this.model.move(this.za[1]*T,this.za[2]*T,0,null),this.model.scaleModel(m)}else if("il"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.LinearInterpolator;else if("ib"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.BounceInterpolator;else if("io"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.OvershootInterpolator;else if("ia"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.AnticipateInterpolator;else if("iao"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.AnticipateOvershootInterpolator;else if("iad"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.AccelerateDecelerateInterpolator;else if("iso"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.SpringOvershootInterpolator;else if("isb"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.SpringBounceInterpolator;else if("igb"===this.toko[this.iTok])this.iTok++,this.interpolator=Interpolator.GravityBounceInterpolator;else if("pt"===this.toko[this.iTok])this.iTok++,this.model.selectPts(this.model.points);else if("seg"===this.toko[this.iTok])this.iTok++,this.model.selectSegs(this.model.segments);else if("end"===this.toko[this.iTok])this.iTok=this.toko.length;else{if("t"===this.toko[this.iTok]||"rparent"===this.toko[this.iTok]||"u"===this.toko[this.iTok]||"co"===this.toko[this.iTok])return console.log("Warn unnecessary token :"+this.toko[this.iTok]+"\n"),this.iTok++,-1;this.iTok++}return this.iTok},listPoints:function(){for(var t=[];Number.isInteger(Number(this.toko[this.iTok]));)t.push(this.model.points[this.toko[this.iTok++]]);return t},listSegments:function(){for(var t=[];Number.isInteger(Number(this.toko[this.iTok]));)t.push(this.model.segments[this.toko[this.iTok++]]);return t},listFaces:function(){for(var t=[];Number.isInteger(Number(this.toko[this.iTok]));)t.push(this.model.faces[this.toko[this.iTok++]]);return t},command:function(t){if(this.state===State.idle){if("u"===t)return this.toko=this.done.slice().reverse(),void this.undo();if(t.startsWith("read")){var i=t.substring(5);if(-1!==i.indexOf("script")){var e=i.substring(7);t=document.getElementById(e).text}else t=this.readfile(i.trim());if(null===t)return;this.done=[],this.undo=[]}else{if("co"===t||"pa"===t)return;t.startsWith("d")&&(this.done=[],this.undo=[])}return this.toko=this.tokenize(t),this.state=State.run,this.iTok=0,void this.commandLoop()}this.state!==State.run?this.state!==State.anim?this.state!==State.pause?this.state===State.undo&&!1===this.undoInProgress&&("u"===t?this.undo():"co"===t?(this.state=State.run,this.commandLoop()):"pa"===t||(this.iTok--,this.toko=this.tokenize(t),this.state=State.run,this.iTok=0,this.commandLoop())):"co"===t?(this.pauseDuration=(new Date).getTime()-this.pauseStart,this.state=State.anim):"u"===t&&(this.state=State.undo,this.undo()):"pa"===t&&(this.state=State.pause):this.commandLoop()},commandLoop:function(){for(;this.iTok<this.toko.length;){if("t"===this.toko[this.iTok])return this.done.push(this.toko[this.iTok++]),this.done.push(this.toko[this.iTok]),this.duration=this.toko[this.iTok++],this.pauseDuration=0,this.state=State.anim,void this.animStart();if("rparent"!==this.toko[this.iTok]){var t=this.iTok,i=this.execute();for(this.pushUndo();t<i;)this.done.push(this.toko[t++]);this.model.change=!0}else this.done.push(this.toko[this.iTok++])}this.state===State.run&&(this.state=State.idle)},animStart:function(){this.model.change=!0,this.tstart=(new Date).getTime(),this.tpi=0},anim:function(){if(this.state===State.undo){var t=this.popUndo()>this.iTok;return!1===t&&(this.undoInProgress=!1),t}if(this.state===State.pause)return this.pauseStart=(new Date).getTime(),!1;if(this.state!==State.anim)return!1;var i=((new Date).getTime()-this.tstart-this.pauseDuration)/this.duration;for(i>1&&(i=1),this.tni=this.interpolator(i),this.iBeginAnim=this.iTok;"rparent"!==this.toko[this.iTok];)if(this.execute(),this.iTok===this.toko.length){console.log("Warning missing parent !");break}if(this.pushUndo(),this.tpi=this.tni,i>=1){for(this.tni=1,this.tpi=0;this.iBeginAnim<this.iTok;)this.done.push(this.toko[this.iBeginAnim++]);return this.state=State.run,this.commandLoop(),this.state===State.anim}return this.iTok=this.iBeginAnim,!0},pushUndo:function(){},popUndo:function(){}};var Model,Point,Segment;View2d.prototype={constructor:View2d,mouseDown:function(t){var i=t.target.getBoundingClientRect(),e=t.clientX-i.left,n=t.clientY-i.top,o=t.target.view2d,s=o.scale;o.xOffset,o.yOffset},drawPoint:function(){var t=this.ctx,i=this.scale,e=this.xOffset,n=this.yOffset,o=this.model.points;t.font="18px serif",t.strokeStyle="blue",o.forEach((o,s)=>{var r=o.xf*i+e,h=-o.yf*i+n;t.fillStyle="skyblue",t.beginPath(),t.arc(r,h,12,0,2*Math.PI),t.stroke(),t.fill(),t.fillStyle="black",s<10?t.fillText(String(s),r-4,h+5):t.fillText(String(s),r-8,h+5)})},drawSegment:function(){var t=this.ctx,i=this.scale,e=this.xOffset,n=this.yOffset,o=this.model.segments;t.font="18px serif",t.strokeStyle="green",o.forEach((o,s)=>{var r=o.p1.xf*i+e,h=-o.p1.yf*i+n,a=o.p2.xf*i+e,l=-o.p2.yf*i+n,c=(r+a)/2,u=(h+l)/2;o.highlight?t.strokeStyle="red":t.strokeStyle="green",t.beginPath(),t.moveTo(r,h),t.lineTo(a,l),t.closePath(),t.stroke(),t.fillStyle="lightgreen",t.beginPath(),t.arc(c,u,12,0,2*Math.PI),t.stroke(),t.fill(),t.fillStyle="black",s<10?t.fillText(String(s),c-4,u+5):t.fillText(String(s),c-8,u+5)})},drawFaces:function(){var t=this.ctx,i=this.scale,e=this.xOffset,n=this.yOffset,o=this.model.faces;t.font="18px serif",t.strokeStyle="black",o.forEach((o,s)=>{var r=o.points,h=0,a=0;t.beginPath();var l=r[0].xf*i+e,c=-r[0].yf*i+n;t.moveTo(l,c),r.forEach(function(o){l=o.xf*i+e,c=-o.yf*i+n,t.lineTo(l,c),h+=l,a+=c}),t.closePath(),t.fillStyle="lightblue",t.fill(),h/=r.length,a/=r.length,t.beginPath(),t.arc(h,a,12,0,2*Math.PI),t.stroke(),t.fillStyle="lightcyan",t.fill(),t.fillStyle="black",s<10?t.fillText(String(s),h-4,a+5):t.fillText(String(s),h-8,a+5)})},draw:function(){null!==this.canvas2d&&(this.ctx.clearRect(0,0,this.canvas2d.width,this.canvas2d.height),this.drawFaces(),this.drawSegment(),this.drawPoint())},fit:function(){var t=this.model.get2DBounds(),i=t.xmax-t.xmin,e=t.ymax-t.ymin,n=this.canvas2d.clientWidth,o=this.canvas2d.clientHeight;this.canvas2d.width=n,this.canvas2d.height=o;const s=n/i,r=o/e;this.scale=Math.min(s,r)/1.1,this.xOffset=n/2,this.yOffset=o/2}};var Model;View3d.FaceVertexShaderSrc="attribute vec4 a_Position;\nattribute vec2 a_TexCoordFront;\nattribute vec2 a_TexCoordBack;\nuniform mat4 u_MvMatrix;\nvarying vec2 v_TexCoordFront;\nvarying vec2 v_TexCoordBack;\nvoid main() {\n  gl_Position = u_MvMatrix * a_Position;\n  v_TexCoordFront = a_TexCoordFront;\n  v_TexCoordBack = a_TexCoordBack;\n}\n",View3d.FaceFragmentShaderSrc="#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform sampler2D u_SamplerFront;\nuniform sampler2D u_SamplerBack;\nvarying vec2 v_TexCoordFront;\nvarying vec2 v_TexCoordBack;\nvoid main() {\nif (gl_FrontFacing){ \n  gl_FragColor = texture2D(u_SamplerFront, v_TexCoordFront);}\nelse { \n  gl_FragColor = texture2D(u_SamplerBack, v_TexCoordBack); }\n}\n",View3d.currentAngle=[0,0],View3d.scale=1,View3d.g_MvpMatrix=new Float32Array(16),View3d.g_MvCurrentMatrix=new Float32Array(16),View3d.wTexFront=1,View3d.hTexFront=1,View3d.wTexBack=1,View3d.hTexBack=1,View3d.prototype={constructor:View3d,initWebGL:function(){this.initShaders(),this.initTextures(),this.initPerspective(),this.initMouseListeners()},initShaders:function(){const t=this.gl,i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,View3d.FaceVertexShaderSrc),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||alert("An error occurred compiling the shader: "+t.getShaderInfoLog(i));const e=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(e,View3d.FaceFragmentShaderSrc),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)||alert("An error occurred compiling the shader: "+t.getShaderInfoLog(e));const n=t.createProgram();t.attachShader(n,i),t.attachShader(n,e),t.linkProgram(n),t.useProgram(n),t.faceShaderProgram=n;const o=t.getAttribLocation(n,"a_Position");t.enableVertexAttribArray(o);const s=t.getAttribLocation(n,"a_TexCoordFront");t.enableVertexAttribArray(s);const r=t.getAttribLocation(n,"a_TexCoordBack");t.enableVertexAttribArray(r)},initBuffers:function(){const t=this.gl;for(var i=[],e=[],n=[],o=[],s=[],r=[],h=[],a=0,l=0;l<this.model.faces.length;l++){var c=this.model.faces[l],u=c.points;c.computeFaceNormal();for(var d=c.normal,p=u[0],f=u[1],m=2;m<u.length;m++){var g=c.points[m];i.push(p.x+c.offset*d[0]),i.push(p.y+c.offset*d[1]),i.push(p.z+c.offset*d[2]),o.push(d[0]),o.push(d[1]),o.push(d[2]),s.push(-d[0]),s.push(-d[1]),s.push(-d[2]),e.push((200+p.xf)/View3d.wTexFront),e.push((200+p.yf)/View3d.hTexFront),n.push((200+p.xf)/View3d.wTexBack),n.push((200+p.yf)/View3d.hTexBack),r.push(a),h.push(a),a++,i.push(f.x+c.offset*d[0]),i.push(f.y+c.offset*d[1]),i.push(f.z+c.offset*d[2]),o.push(d[0]),o.push(d[1]),o.push(d[2]),s.push(-d[0]),s.push(-d[1]),s.push(-d[2]),e.push((200+f.xf)/View3d.wTexFront),e.push((200+f.yf)/View3d.hTexFront),n.push((200+f.xf)/View3d.wTexBack),n.push((200+f.yf)/View3d.hTexBack),r.push(a),h.push(a+1),a++,i.push(g.x+c.offset*d[0]),i.push(g.y+c.offset*d[1]),i.push(g.z+c.offset*d[2]),o.push(d[0]),o.push(d[1]),o.push(d[2]),s.push(-d[0]),s.push(-d[1]),s.push(-d[2]),e.push((200+g.xf)/View3d.wTexFront),e.push((200+g.yf)/View3d.hTexFront),n.push((200+g.xf)/View3d.wTexBack),n.push((200+g.yf)/View3d.hTexBack),r.push(a),h.push(a-1),a++,f=g}}var k=new Float32Array(i),v=new Float32Array(e),T=new Float32Array(n);this.initArrayBuffer(t,t.faceShaderProgram,k,3,t.FLOAT,"a_Position"),this.initArrayBuffer(t,t.faceShaderProgram,v,2,t.FLOAT,"a_TexCoordFront"),this.initArrayBuffer(t,t.faceShaderProgram,T,2,t.FLOAT,"a_TexCoordBack");var x=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,x);var y=new Uint8Array(r);t.bufferData(t.ELEMENT_ARRAY_BUFFER,y,t.STATIC_DRAW),this.nbFacesVertice=y.length},initArrayBuffer:function(t,i,e,n,o,s){var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW);var h=t.getAttribLocation(i,s);t.vertexAttribPointer(h,n,o,!1,0,0),t.enableVertexAttribArray(h)},initTextures:function(){const t=this.gl;t.useProgram(t.faceShaderProgram);var i=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([112,172,243,255]));var e=t.getUniformLocation(t.faceShaderProgram,"u_SamplerFront");t.uniform1i(e,0);var n=t.createTexture();t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([253,236,67,255]));var o=t.getUniformLocation(t.faceShaderProgram,"u_SamplerBack");t.uniform1i(o,1)},initPerspective:function(){const t=this.gl;t.clearColor(.8,228/255,1,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),this.resizeCanvasToDisplaySize(this.canvas3d),t.viewport(0,0,this.canvas3d.width,this.canvas3d.height),t.viewport(0,0,this.canvas3d.width,this.canvas3d.height);var i=View3d.g_MvpMatrix,e=this.canvas3d.width/this.canvas3d.height,n=30,o=-30,s=-30,r=30;e>=1?(s=(o=-(n=50*Math.tan(Math.PI/360*40)))*e,r=n*e):(n=(r=50*Math.tan(Math.PI/360*40))/e,o=(s=-r)/e);var h=r-s,a=n-o;i[0]=100/h,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=100/a,i[6]=0,i[7]=0,i[8]=(s+r)/h,i[9]=(n+o)/a,i[10]=-1250/1150,i[11]=-1,i[12]=0,i[13]=0,i[14]=-12e4/1150,i[15]=0},resizeCanvasToDisplaySize:function(t,i){i=i||1;const e=t.clientWidth*i|0,n=t.clientHeight*i|0;t.width===e&&t.height===n||(t.width=e,t.height=n)},initMouseListeners:function(){View3d.lastX=-1,View3d.lastY=-1,View3d.touchtime=0,this.canvas3d.addEventListener("mousedown",this.mousedown),this.canvas3d.addEventListener("mouseup",this.mouseup),this.canvas3d.addEventListener("mousemove",this.mousemove),this.canvas3d.addEventListener("touchstart",this.mousedown,{capture:!0,passive:!0}),this.canvas3d.addEventListener("touchend",this.mouseup,{capture:!0,passive:!0}),this.canvas3d.addEventListener("touchmove",this.mousemove,{capture:!0,passive:!0})},mousedown:function(t){0===View3d.touchtime?View3d.touchtime=(new Date).getTime():(new Date).getTime()-View3d.touchtime<800?(View3d.currentAngle[0]=0,View3d.currentAngle[1]=0,View3d.scale=1,View3d.touchtime=0):View3d.touchtime=(new Date).getTime(),t.preventDefault();var i=t.changedTouches?t.changedTouches[0]:t;const e=i.clientX,n=i.clientY,o=t.target.getBoundingClientRect();o.left<=e&&e<o.right&&o.top<=n&&n<o.bottom&&(View3d.lastX=e,View3d.lastY=n,View3d.dragging=!0)},mouseup:function(t){t.preventDefault(),View3d.dragging=!1},mousemove:function(t){t.preventDefault();var i=t.changedTouches?t.changedTouches[0]:t;const e=i.clientX,n=i.clientY;if(View3d.dragging)if(t.shiftKey||void 0!==t.scale&&1!==t.scale)void 0===t.scale?View3d.scale-=(n-View3d.lastY)/300:View3d.scale=t.scale;else{const i=300/t.target.height,o=i*(e-View3d.lastX),s=i*(n-View3d.lastY);View3d.currentAngle[0]=View3d.currentAngle[0]+s,View3d.currentAngle[1]=View3d.currentAngle[1]+o}View3d.lastX=e,View3d.lastY=n},draw:function(){const t=this.gl;this.resizeCanvasToDisplaySize(this.canvas3d),t.useProgram(t.faceShaderProgram);var i=View3d.g_MvpMatrix,e=new Float32Array(16),n=Math.sin(View3d.currentAngle[0]/200),o=Math.cos(View3d.currentAngle[0]/200);e[0]=i[0],e[4]=o*i[4]+n*i[8],e[8]=o*i[8]-n*i[4],e[12]=i[12],e[1]=i[1],e[5]=o*i[5]+n*i[9],e[9]=o*i[9]-n*i[5],e[13]=i[13],e[2]=i[2],e[6]=o*i[6]+n*i[10],e[10]=o*i[10]-n*i[9],e[14]=i[14],e[3]=i[3],e[7]=o*i[7]+n*i[11],e[11]=o*i[11]-n*i[10],e[15]=i[15];var s=e.slice(0);n=Math.sin(View3d.currentAngle[1]/100),o=Math.cos(View3d.currentAngle[1]/100),s[0]=o*e[0]-n*e[8],s[4]=e[4],s[8]=o*e[8]+n*e[0],s[12]=e[12],s[1]=o*e[1]-n*e[9],s[5]=e[5],s[9]=o*e[9]+n*e[1],s[13]=e[13],s[2]=o*e[2]-n*e[10],s[6]=e[6],s[10]=o*e[10]+n*e[2],s[14]=e[14],s[3]=o*e[3]-n*e[11],s[7]=e[7],s[11]=o*e[11]+n*e[3],s[15]=e[15],n=View3d.scale,e[0]=n*s[0],e[4]=n*s[4],e[8]=n*s[8],e[12]=n*s[12],e[1]=n*s[1],e[5]=n*s[5],e[9]=n*s[9],e[13]=n*s[13],e[2]=n*s[2],e[6]=n*s[6],e[10]=n*s[10],e[14]=n*s[14],e[3]=n*s[3],e[7]=n*s[7],e[11]=n*s[11],e[15]=n*s[15],e[15]+=700;var r=t.getUniformLocation(t.faceShaderProgram,"u_MvMatrix");t.uniformMatrix4fv(r,!1,e),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.activeTexture(t.TEXTURE0),t.cullFace(t.BACK),t.drawElements(t.TRIANGLES,this.nbFacesVertice,t.UNSIGNED_BYTE,0),t.activeTexture(t.TEXTURE1),t.cullFace(t.FRONT),t.drawElements(t.TRIANGLES,this.nbFacesVertice,t.UNSIGNED_BYTE,0)}};var Command;CommandArea.keypress=function(t){var i=t.target,e=t.key?t.key:String.fromCharCode(Number(t.charCode));if(e=13===t.keyCode?"Enter":e,t.target.scrollTop=t.target.scrollHeight,"Enter"===e){var n=i.selectionStart,o=i.value,s=o.lastIndexOf("\n",n-1)+1,r=o.indexOf("\n",n);-1===r&&(i.value+="\n",r=o.length);var h=o.substring(s,r);t.preventDefault(),r!==o.length&&(i.value+=h+"\n"),CommandArea.cde.command(h)}},CommandArea.prototype={constructor:CommandArea};var Model,View2d,View3d,Command,CommandArea;Orisim3d.prototype={constructor:Orisim3d};var orisim3d=null;"undefined"!=typeof window&&window.addEventListener("load",completed),Menu.prototype={constructor:Menu,click:function(t){var i=window.document.getElementsByClassName("menu")[0].children;if(t.target===i[0]||t.target.parentNode===i[0]){for(var e=0;e<i.length;e++)i[e].style.display="block";i[0].style.display="none"}else if(t.target===i[1]||t.target.parentNode===i[1]){for(var n=0;n<i.length;n++)i[n].style.display="none";i[0].style.display="block"}for(var o=2;o<i.length;o++)if(i[o]===t.target||i[o]===t.target.parentNode||i[o]===t.target.parentNode.parentNode){i[o].getElementsByTagName("rect")[0].style["stroke-width"]="2px";var s=i[o].getAttribute("model");if(s){var r=document.getElementById(s);if(r){var h=r.textContent;void 0!==orisim3d&&orisim3d.command.command(h)}}}else i[o].getElementsByTagName("rect")[0].style["stroke-width"]="0.4px"}},"undefined"!=typeof window&&window.addEventListener("load",function(){var t=window.document.getElementsByClassName("menu")[0];t&&new Menu(t)});
  </script>
</head>
<body>
  <div id="height100">
    <canvas id="canvas3d"></canvas>
    <!-- Menu Element in html page-->
    <div class="menu">
      <svg class="svg-icon" viewBox="0 0 12 12" style="display:block">
        <path id="d1" d="M 2,3 10,3 Z" style="stroke:#00f;stroke-width:1"/>
        <path id="d2" d="M 2,6 10,6 Z" style="stroke:#00f;stroke-width:1"/>
        <path id="d3" d="M 2,9 10,9 Z" style="stroke:#00f;stroke-width:1"/>
        <rect id="d4" height="12" width="12" rx="2" style="fill:none;stroke:#000;stroke-width:0.4"/>
      </svg>
      <svg class="svg-icon" viewBox="0 0 12 12" style="display:none">
        <path d="M 2,2 10,10 Z" style="stroke:#00f;stroke-width:1.0"/>
        <path d="M 2,10 10,2 Z" style="fill:none;stroke:#00f;stroke-width:1.0"/>
        <rect height="12" width="12" rx="2" style="fill:none;stroke:#000;stroke-width:0.4"/>
      </svg>
      <svg model="cocotte.txt" class="svg-icon" viewBox="36 0 36 36" style="display:none">
        <linearGradient
            id="BleuCiel">
          <stop
              style="stop-color:#bcd3ff;stop-opacity:1;"
              offset="0"
              id="stop3612-6" />
          <stop
              style="stop-color:#60afff;stop-opacity:1;"
              offset="1"
              id="stop3614-98" />
        </linearGradient>
        <linearGradient
            id="Bleu">
          <stop
              style="stop-color:#216bff;stop-opacity:1;"
              offset="0"
              id="stop3612-1" />
          <stop
              style="stop-color:#003399;stop-opacity:1;"
              offset="1"
              id="stop3614-5" />
        </linearGradient>
        <linearGradient
            id="Jaune">
          <stop
              id="stop5923-4-6"
              offset="0"
              style="stop-color:#ffcc00;stop-opacity:1;" />
          <stop
              id="stop5925-0-8"
              offset="1"
              style="stop-color:#ff6600;stop-opacity:1;" />
        </linearGradient>
        <linearGradient
            xlink:href="#BleuCiel"
            id="linearGradient4798"
            gradientUnits="userSpaceOnUse"
            gradientTransform="matrix(0.073224,0,0,0.073224,59.74168,-1.332436)"
            x1="-95.261261"
            y1="32.908539"
            x2="-92.15432"
            y2="484.8978" />
        <linearGradient
            xlink:href="#Bleu"
            id="linearGradient4785"
            gradientUnits="userSpaceOnUse"
            gradientTransform="matrix(0.6102,0,0,0.524772,66.374554,56.355872)"
            x1="-31.395815"
            y1="-82.941772"
            x2="-31.563984"
            y2="-50.584309" />
        <linearGradient
            xlink:href="#Bleu"
            id="linearGradient1194"
            gradientUnits="userSpaceOnUse"
            x1="31.346756"
            y1="32.497768"
            x2="31.185341"
            y2="51.385605"
            gradientTransform="matrix(0.6102,0,0,0.6102,36.31,0.3029)" />
        <linearGradient
            xlink:href="#Jaune"
            id="linearGradient4789"
            gradientUnits="userSpaceOnUse"
            gradientTransform="matrix(0,0.036612,-0.036612,0,89.250952,29.946416)"
            x1="-726.53772"
            y1="1110.3765"
            x2="-336.62952"
            y2="1105.5341" />
        <rect
            id="rect5032"
            rx="4.2714"
            ry="4.2714"
            y="0.30289999"
            x="36.310001"
            height="35.391602"
            width="35.391602"
            style="fill:url(#linearGradient4798);fill-opacity:1;stroke:#000000;stroke-width:1" />
        <path
            style="fill:url(#linearGradient4785)"
            d="m 40.697338,31.886852 -0.06102,-16.71948 6.333876,-5.851818 8.457372,8.677044 z" />
        <path
            d="m 47.012908,25.864178 8.414658,-7.87158 13.552542,14.58378 H 53.188132 Z"
            style="fill:url(#linearGradient1194)"/>
        <path
            d="M 55.403158,2.963372 V 17.992598 L 40.929214,3.042698 Z"
            style="fill:url(#linearGradient4789)" />
      </svg>
    </div>
  </div>

  <!-- Inline model -->
  <script id="cocotte.txt" type="not-javascript">
  // Cocotte
  d -200 200 -200 -200 200 -200 200 200
  // Marque les médianes et diagonales
  c 0 1 c 0 3 c 0 2 c 1 3
  // Marque les demi-bords
  c 0 8 c 8 3 c 0 4 c 4 1
  // Marque les coins
  c 6 0 c 6 1 c 6 2 c 6 3
  // Retourne iad interpolateur accelerate decelerate
  iad
  t 500 ty 180)
  // Replie le coin et retourne
  t 1000 r 48 180 21 0 10)
  o 1 24 0 7 25
  t 500 ty 180)
  // Bord haut
  t 1000 r 35 179 8 17 3) // Pas mal
  t 500 r 55 90 17 3 a 3 19)
  // Côté droit
  t 1000 r 29 179 5 22 2 a 19 3 17)
  t 500 r 54 -45 19 3 17)
  t 100 r 55 -30 17 a 3) // Ferme la patte
  // Oreille bas
  t 500 r 53 -90 22 2 a 2 18) // Bof à revoir
  t 1000 r 45 179 1 12 7 a 18 2 22)
  t 500 r 53 -87 22 2 18 a 18 2)
  t 100 r 52 30 18 a 2) // Ferme la patte
  // Oreille bas gauche
  t 500 r 50 -90 1 12 a 1 24)
  t 1000 r 23 179 4 a 24 1 12)
  t 500 r 50 -87 12 1 24 a 24 1)
  t 100 r 50 -30 24 a 1) // Ferme la patte
  // Replie en ouvrant le bec
  t 500 r 16 -90 10 8 20 17 16 14 3 19 r 40 -90 0)
  t 500 r 16 -80 10 8 20 17 16 14 3 19 a 0)
  // Ajuste à peu près
  o 0
  r 24 10 4 r 37 -10 8
  r 29 -5 5 8 r 23 -5 7 4
  // Montre
  iao t 1000 zf) t 1000 tz -45) t 1000 zf)
  iso t 4000 ty 360)
  </script>

</body>
</html>